<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Démo 3D (Fichier Unique)</title>
    
    <style>
        /* Réinitialisation de base */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Empêche les barres de défilement */
            background-color: #000;
        }

        /* Le canevas du jeu prend tout l'écran */
        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Style de l'écran de démarrage */
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            font-family: sans-serif;
            flex-direction: column;
        }

        #startButton {
            font-size: 2rem;
            padding: 20px 40px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <div id="startScreen">
        <h1>Démo 3D</h1>
        <p>Cliquez pour démarrer en plein écran et paysage</p>
        <button id="startButton">Commencer</button>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>
    
    <script type="module">
        // On importe Three.js comme défini dans l'importmap
        import * as THREE from 'three';

        // Références aux éléments HTML
        const canvas = document.getElementById('gameCanvas');
        const startScreen = document.getElementById('startScreen');
        const startButton = document.getElementById('startButton');

        // Variables de base pour Three.js
        let scene, camera, renderer, cube;

        function init() {
            // 1. Scène
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x111111); // Fond gris foncé

            // 2. Caméra
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5; // Recule la caméra pour voir le cube

            // 3. Rendu (Renderer)
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            // 4. Créer un objet (un cube)
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshNormalMaterial(); // Matériau qui change de couleur
            cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            // 5. Gérer le redimensionnement de la fenêtre
            window.addEventListener('resize', onWindowResize, false);

            // 6. Démarrer la boucle de jeu
            animate();
        }

        // Boucle de jeu (appelée à chaque frame)
        function animate() {
            requestAnimationFrame(animate);

            // Faire tourner le cube
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;

            // Rendre la scène
            renderer.render(scene, camera);
        }

        // Fonction pour gérer le redimensionnement
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // --- GESTION DU PLEIN ÉCRAN ET DE L'ORIENTATION ---

        startButton.addEventListener('click', () => {
            
            // --- 1. Demander le plein écran ---
            // On le demande sur 'document.documentElement' (la page entière)
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen();
            } else if (document.documentElement.mozRequestFullScreen) { // Firefox
                document.documentElement.mozRequestFullScreen();
            } else if (document.documentElement.webkitRequestFullscreen) { // Chrome, Safari, Opera
                document.documentElement.webkitRequestFullscreen();
            } else if (document.documentElement.msRequestFullscreen) { // IE/Edge
                document.documentElement.msRequestFullscreen();
            }

            // --- 2. Demander l'orientation paysage (horizontal) ---
            // C'est la partie la plus importante pour le mobile
            try {
                // Tente d'utiliser l'API moderne
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape')
                        .then(() => {
                            console.log('Orientation verrouillée en paysage');
                        })
                        .catch((error) => {
                            // Affiche une erreur si ça échoue (ex: sur PC, ou si l'utilisateur refuse)
                            console.warn('Impossible de verrouiller l\'orientation:', error);
                        });
                } else {
                    console.warn('API Screen Orientation non supportée.');
                }
            } catch (error) {
                console.error('Erreur lors de la tentative de verrouillage:', error);
            }


            // --- 3. Cacher le bouton et démarrer le "jeu" ---
            startScreen.style.display = 'none';
            
            // Initialiser et démarrer la scène 3D SEULEMENT après l'interaction
            init();
        });
    </script>
</body>
</html>
