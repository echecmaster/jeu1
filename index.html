<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Contrôleur FPS Mobile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <style>
        /* --- 1. La partie CSS (Le style) --- */
        
        /* Réinitialisation de base pour le mode plein écran horizontal */
        body, html {
            margin: 0;
            padding: 0;
            width: 100vw; /* 100% de la largeur de la vue */
            height: 100vh; /* 100% de la hauteur de la vue */
            overflow: hidden; /* Cache les barres de défilement */
            background-color: #111;
        }

        /* Le conteneur principal du "jeu" */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #333; /* Fond du ciel ou zone de jeu */
            overflow: hidden; /* Important pour que la map ne dépasse pas */
        }

        /* La "Map" qui va bouger */
        #map {
            position: absolute;
            /* Position de départ de la map (le joueur est au centre) */
            /* On centre la map au départ */
            left: 50%;
            top: 50%;
            
            /* Taille de la map (plus grande que l'écran) */
            width: 2000px;
            height: 2000px;
            
            /* Centre la map sur son propre milieu */
            transform: translate(-50%, -50%); 

            /* Style visuel de la map (un quadrillage) */
            background-size: 50px 50px;
            background-image:
                linear-gradient(to right, #555 1px, transparent 1px),
                linear-gradient(to bottom, #555 1px, transparent 1px);
            background-color: #2a2a2a; /* Couleur du sol */
        }

        /* Le conteneur de la zone du joystick */
        #joystick-container {
            position: absolute;
            bottom: 30px;
            left: 30px;
            width: 150px;
            height: 150px;
            background-color: rgba(128, 128, 128, 0.4);
            border-radius: 50%; /* Rend le conteneur circulaire */
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        /* Le "stick" (le bouton) du joystick */
        #joystick-knob {
            position: absolute;
            width: 70px;
            height: 70px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            
            /* Centrage initial du stick */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            /* Empêche l'utilisateur de sélectionner le texte du stick */
            user-select: none;
            -webkit-user-select: none; /* Pour Safari */
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="map"></div>
    </div>

    <div id="joystick-container">
        <div id="joystick-knob"></div>
    </div>


    <script>
        // --- 3. La partie JavaScript (La logique) ---

        // Récupération des éléments
        const map = document.getElementById('map');
        const joystickContainer = document.getElementById('joystick-container');
        const joystickKnob = document.getElementById('joystick-knob');

        // Variables pour la position de la map
        // On commence au centre (1000, 1000) de notre map de 2000x2000
        // Mais la transform CSS gère la position, on va utiliser des variables pour le *déplacement*
        let mapX = 0;
        let mapY = 0;
        
        // Variables pour le joystick
        let joystickActive = false;
        let joystickCenterX, joystickCenterY, maxDistance;
        
        // Variables pour le mouvement (vecteur de direction)
        let moveX = 0;
        let moveY = 0;
        const playerSpeed = 3; // Vitesse de déplacement

        // --- Gestion des événements tactiles (Touch) ---

        joystickContainer.addEventListener('touchstart', (e) => {
            // Empêche la page de défiler quand on touche le joystick
            e.preventDefault(); 
            
            joystickActive = true;
            
            // On calcule le centre du joystick et la distance max
            const rect = joystickContainer.getBoundingClientRect();
            joystickCenterX = rect.left + rect.width / 2;
            joystickCenterY = rect.top + rect.height / 2;
            maxDistance = joystickContainer.clientWidth / 2; // Rayon du conteneur
        });

        window.addEventListener('touchmove', (e) => {
            if (!joystickActive) return; // Si le joystick n'est pas activé, on ne fait rien
            
            e.preventDefault();
            
            // Récupère la position du premier doigt
            const touch = e.touches[0];
            const currentX = touch.clientX;
            const currentY = touch.clientY;

            // Calcule le vecteur (direction) depuis le centre du joystick
            let deltaX = currentX - joystickCenterX;
            let deltaY = currentY - joystickCenterY;

            // Calcule la distance du doigt par rapport au centre
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

            // Si le doigt sort du cercle du joystick, on le "clampe" (limite) au bord
            if (distance > maxDistance) {
                deltaX = (deltaX / distance) * maxDistance;
                deltaY = (deltaY / distance) * maxDistance;
            }

            // Met à jour la position visuelle du stick
            // On le déplace par rapport à son centre, pas au coin (d'où le -50%)
            joystickKnob.style.transform = `translate(-50%, -50%) translate(${deltaX}px, ${deltaY}px)`;

            // Met à jour les variables de mouvement (normalisées entre -1 et 1)
            moveX = deltaX / maxDistance;
            moveY = deltaY / maxDistance;
        });

        window.addEventListener('touchend', (e) => {
            if (!joystickActive) return;

            joystickActive = false;
            
            // Réinitialise la position visuelle du stick
            joystickKnob.style.transform = 'translate(-50%, -50%)';
            
            // Arrête le mouvement
            moveX = 0;
            moveY = 0;
        });

        // --- Boucle de jeu (Game Loop) ---

        function gameLoop() {
            // On ne met à jour que s'il y a un mouvement
            if (moveX !== 0 || moveY !== 0) {
                // On SOUSTRAIT le mouvement, car c'est la MAP qui bouge,
                // pas le joueur (effet "première personne").
                mapX -= moveX * playerSpeed;
                mapY -= moveY * playerSpeed;

                // Applique la nouvelle position à la map
                // On combine le déplacement (-50%, -50%) pour le centrage
                // avec le nouveau déplacement (mapX, mapY)
                map.style.transform = `translate(-50%, -50%) translate(${mapX}px, ${mapY}px)`;
            }

            // Demande au navigateur de rappeler cette fonction
            // à la prochaine "frame" (environ 60 fois par seconde)
            requestAnimationFrame(gameLoop);
        }

        // Lance la boucle de jeu
        gameLoop();

    </script>
</body>
</html>
