<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mon FPS Zombie</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <div id="hud">
        <div id="joystick-zone">
            <div id="joystick-base">
                <div id="joystick-stick"></div>
            </div>
        </div>

        <div id="action-zone">
            <button id="shoot-button">TIRER</button>
        </div>
    </div>

    <script src="game.js"></script>
</body>
/* Empêche le défilement et force le plein écran */
body, html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: #000;
    font-family: Arial, sans-serif;
}

/* Le canvas prend tout l'espace derrière l'interface */
#gameCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
}

/* Conteneur principal de l'interface (HUD) */
#hud {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2; /* S'affiche par-dessus le canvas */
    display: flex;
    justify-content: space-between; /* Sépare la gauche et la droite */
    align-items: flex-end; /* Aligne les contrôles en bas */
    /* Empêche le HUD de bloquer les événements sur le canvas,
       sauf sur les éléments spécifiquement définis */
    pointer-events: none; 
}

/* --- Zone Gauche : Joystick --- */
#joystick-zone {
    width: 50%;
    height: 100%;
    display: flex;
    justify-content: flex-start; /* Aligne la base à gauche de la zone */
    align-items: flex-end; /* Aligne la base en bas de la zone */
    padding-left: 5vw;
    padding-bottom: 5vh;
    box-sizing: border-box;
    pointer-events: auto; /* Active les événements tactiles pour cette zone */
}

#joystick-base {
    width: 150px;
    height: 150px;
    background-color: rgba(128, 128, 128, 0.3);
    border-radius: 50%;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    /* Assure que la base est au-dessus du stick pour la référence de position */
}

#joystick-stick {
    width: 80px;
    height: 80px;
    background-color: rgba(255, 255, 255, 0.5);
    border-radius: 50%;
    position: absolute;
    /* Le 'translate' sera géré par JavaScript */
    transition: transform 0.05s ease-out; 
}

/* --- Zone Droite : Bouton de tir --- */
#action-zone {
    width: 50%;
    height: 100%;
    display: flex;
    justify-content: flex-end; /* Aligne le bouton à droite de la zone */
    align-items: flex-end; /* Aligne le bouton en bas de la zone */
    padding-right: 5vw;
    padding-bottom: 5vh;
    box-sizing: border-box;
    pointer-events: auto; /* Active les événements tactiles pour cette zone */
}

#shoot-button {
    width: 120px;
    height: 120px;
    background-color: rgba(255, 0, 0, 0.5);
    border: 3px solid rgba(255, 255, 255, 0.7);
    border-radius: 50%;
    color: white;
    font-size: 24px;
    font-weight: bold;
    user-select: none; /* Empêche la sélection de texte */
    -webkit-tap-highlight-color: transparent; /* Empêche le flash bleu sur mobile */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

#shoot-button:active {
    background-color: rgba(255, 0, 0, 0.8);
}
document.addEventListener('DOMContentLoaded', () => {

    // --- Références aux éléments ---
    const joystickZone = document.getElementById('joystick-zone');
    const joystickStick = document.getElementById('joystick-stick');
    const shootButton = document.getElementById('shoot-button');
    const canvas = document.getElementById('gameCanvas');
    // Si vous utilisiez Three.js pour la 3D, l'initialisation irait ici.

    // --- Variables de jeu (Exemples) ---
    // moveInput contient les commandes du joueur, normalisées entre -1 et 1
    const moveInput = { x: 0, y: 0 };
    let isShooting = false;

    // --- Logique du Joystick ---
    let touchId = null; // ID du doigt qui contrôle le joystick
    let joystickBasePos = { x: 0, y: 0 }; // Position absolue du centre de la base
    const stickMaxMove = 75; // Limite de déplacement du stick (en px)

    /**
     * Calcule et stocke la position absolue du centre de la base du joystick.
     * Cette fonction est appelée au début et potentiellement au redimensionnement.
     */
    function updateJoystickBasePos() {
        const baseRect = joystickStick.parentElement.getBoundingClientRect();
        joystickBasePos = { 
            x: baseRect.left + baseRect.width / 2, 
            y: baseRect.top + baseRect.height / 2 
        };
    }

    // Calculer la position une première fois au chargement
    updateJoystickBasePos();

    // Recalculer la position si la fenêtre est redimensionnée (important pour mobile)
    window.addEventListener('resize', updateJoystickBasePos);


    joystickZone.addEventListener('touchstart', (e) => {
        e.preventDefault(); // Empêche le défilement de la page
        if (touchId === null) { // Prend le premier doigt qui touche la zone
            const touch = e.changedTouches[0];
            touchId = touch.identifier;
            
            // Assurez-vous d'avoir la position de base la plus récente
            updateJoystickBasePos(); 
        }
    }, { passive: false });

    joystickZone.addEventListener('touchmove', (e) => {
        e.preventDefault();
        // Trouver le doigt qui a initié le mouvement
        const touch = Array.from(e.changedTouches).find(t => t.identifier === touchId);

        if (touch) {
            // Calculer le déplacement (delta) par rapport au centre de la base
            let deltaX = touch.clientX - joystickBasePos.x;
            let deltaY = touch.clientY - joystickBasePos.y;

            // Limiter la distance pour que le stick ne sorte pas de la base
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            if (distance > stickMaxMove) {
                // Normaliser et multiplier par la distance maximale
                deltaX = (deltaX / distance) * stickMaxMove;
                deltaY = (deltaY / distance) * stickMaxMove;
            }

            // Déplacer le stick visuellement
            joystickStick.style.transform = `translate(${deltaX}px, ${deltaY}px)`;

            // Mettre à jour les valeurs de mouvement (normalisées entre -1 et 1)
            // L'axe Y est inversé pour les jeux (Haut = -Y de l'écran, mais +1 en jeu)
            moveInput.x = deltaX / stickMaxMove;
            moveInput.y = -deltaY / stickMaxMove; 
        }
    }, { passive: false });

    joystickZone.addEventListener('touchend', (e) => {
        // Trouver le doigt qui se lève
        const touch = Array.from(e.changedTouches).find(t => t.identifier === touchId);
        
        if (touch) {
            // Réinitialiser le joystick
            touchId = null;
            joystickStick.style.transform = `translate(0px, 0px)`;
            moveInput.x = 0;
            moveInput.y = 0;
        }
    });

    // --- Logique du Bouton de Tir ---
    shootButton.addEventListener('touchstart', (e) => {
        e.preventDefault();
        isShooting = true;
        // console.log("TIR COMMENCÉ !");
    }, { passive: false });

    shootButton.addEventListener('touchend', (e) => {
        e.preventDefault();
        isShooting = false;
        // console.log("TIR ARRÊTÉ.");
    }, { passive: false });


    // --- Boucle de Jeu (Game Loop) ---
    function gameLoop() {
        // 1. Lire les entrées (moveInput et isShooting sont mis à jour par les listeners)
        // Ceci est la ligne cruciale pour votre logique de jeu :
        // console.log(`Mouvement: X=${moveInput.x.toFixed(2)}, Y=${moveInput.y.toFixed(2)} | Tir: ${isShooting}`);
        
        // 2. Mettre à jour la logique du jeu
        // C'EST ICI QUE VOUS UTILISEREZ moveInput.x, moveInput.y et isShooting
        // pour déplacer votre caméra/joueur, gérer les collisions, et lancer des actions.

        // 3. Rendre la scène
        // Si vous utilisez Three.js, vous appelleriez ici le `renderer.render(scene, camera);`
        
        // Redemande au navigateur de lancer cette fonction à la prochaine frame
        requestAnimationFrame(gameLoop);
    }

    // Lancer le jeu
    console.log("Jeu lancé. Initialisation de la boucle...");
    gameLoop();
});

</html>
